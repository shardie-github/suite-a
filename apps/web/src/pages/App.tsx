import React,{useState} from "react"; const API=localStorage.getItem("API")||"http://127.0.0.1:4000"; export default function App(){ const [email,setEmail]=useState("owner@example.com"); const [password,setPassword]=useState("password123"); const [token,setToken]=useState<string>(""); const [orgId,setOrgId]=useState<string>(""); const req=(p:string,init?:RequestInit)=>fetch(API+p,{headers:{ "content-type":"application/json", ...(token?{authorization:"Bearer "+token}:{}) },...init}); const signup=async()=>{const r=await req("/auth/signup",{ method:"POST", body:JSON.stringify({ email, password, orgName:"My Org" })}); const d=await r.json(); if(d.access){setToken(d.access); setOrgId(d.org.id);} }; const login=async()=>{const r=await req("/auth/login",{ method:"POST", body:JSON.stringify({ email, password })}); const d=await r.json(); if(d.access) setToken(d.access);}; const health=async()=>alert(await (await req("/health")).text()); const flags=async()=>alert(await (await fetch(API+"/flags",{ headers:{authorization:"Bearer "+token,"x-org-id":orgId} })).text()); const checkout=async()=>{const r=await req("/billing/create-checkout",{ method:"POST", body:JSON.stringify({ orgId, priceId:"price_123", success_url:location.href, cancel_url:location.href })}); const d=await r.json(); if(d.url) location.href=d.url;}; return (<main style={{padding:16,fontFamily:"system-ui"}}><h1>Suite Web</h1><p>API: {API}</p><input value={email} onChange={e=>setEmail(e.target.value)} placeholder="email" /><input value={password} onChange={e=>setPassword(e.target.value)} placeholder="password" type="password"/><div style={{display:"flex", gap:8, margin:"12px 0"}}><button onClick={signup}>Sign up</button><button onClick={login}>Login</button><button onClick={health}>Health</button><button onClick={flags} disabled={!token||!orgId}>Flags (auth+tenant)</button><button onClick={checkout} disabled={!token||!orgId}>Stripe Checkout</button></div><p>Token: <code style={{wordBreak:"break-all"}}>{token.slice(0,24)}...</code></p><p>Org: <code>{orgId}</code></p></main>); }
